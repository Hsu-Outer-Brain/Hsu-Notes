# 最强最全面的数仓建设规范指南 （一）-阿里云开发者社区
[最强最全面的数仓建设规范指南 （一）- 阿里云开发者社区](https://developer.aliyun.com/article/901341) 

 版权声明：

本文内容由阿里云实名注册用户自发贡献，版权归原作者所有，阿里云开发者社区不拥有其著作权，亦不承担相应法律责任。具体规则请查看《 [阿里云开发者社区用户服务协议](https://developer.aliyun.com/article/768092)》和 《[阿里云开发者社区知识产权保护指引](https://developer.aliyun.com/article/768093)》。如果您发现本社区中有涉嫌抄袭的内容，填写 [侵权投诉表单](https://yida.alibaba-inc.com/o/right)进行举报，一经查实，本社区将立刻删除涉嫌侵权内容。

本文将全面讲解数仓建设规范，从数据模型规范，到数仓公共规范，数仓各层规范，最后到数仓命名规范，包括表命名，指标字段命名规范等！

目录：

一、数据模型架构原则

1.  数仓分层原则
2.  主题域划分原则
3.  数据模型设计原则

二、数仓公共开发规范

1.  层次调用规范
2.  数据类型规范
3.  数据冗余规范
4.  NULL 字段处理规范
5.  指标口径规范
6.  数据表处理规范
7.  表的生命周期管理

三、数仓各层开发规范

1.  ODS 层设计规范
2.  公共维度层设计规范
3.  DWD 明细层设计规范
4.  DWS 公共汇总层设计规范

四、数仓命名规范

1.  词根设计规范
2.  表命名规范
3.  指标命名规范

## 一、数据模型架构原则

### **1. 数仓分层原则**

优秀可靠的数仓体系，往往需要清晰的数据分层结构，即要保证数据层的稳定又要屏蔽对下游的影响，并且要避免链路过长。那么问题来了，一直在讲数仓要分层，那数仓分几层最好？

目前市场上主流的分层方式眼花缭乱，不过看事情不能只看表面，还要看到内在的规律，不能为了分层而分层，没有最好的，只有适合的。

分层是以解决当前业务快速的数据支撑为目的，为未来抽象出共性的框架并能够赋能给其他业务线，同时为业务发展提供稳定、准确的数据支撑，并能够按照已有的模型为新业务发展提供方向，也就是数据驱动和赋能。

一个好的分层架构，要有以下好处：

1.  清晰数据结构；
2.  数据血缘追踪；
3.  减少重复开发；
4.  数据关系条理化；
5.  屏蔽原始数据的影响。

数仓分层要结合公司业务进行，并且需要清晰明确各层职责，一般采用如下分层结构：

 ![](https://github.com/Hsu-Outer-Brain/WebCliperCDN_001/blob/main/img3/2024-7-18%2015-05-16/fa875946-48c7-4fea-826f-818bc1e0f49d.png?raw=true) 数据分层架构

数仓建模在哪层建设呢？我们以维度建模为例，建模是在数据源层的下一层进行建设，在上图中，就是在 DW 层进行数仓建模，所以 DW 层是数仓建设的核心层。

下面详细阐述下每层建设规范，和上图的分层稍微有些区别：

#### 1. 数据源层：ODS（Operational Data Store）

ODS 层，是最接近数据源中数据的一层，为了考虑后续可能需要追溯数据问题，因此对于这一层就不建议做过多的数据清洗工作，原封不动地接入原始数据即可，至于数据的去噪、去重、异常值处理等过程可以放在后面的 DWD 层来做。

#### 2. 数据仓库层：DW（Data Warehouse）

数据仓库层是我们在做数据仓库时要核心设计的一层，在这里，从 ODS 层中获得的数据按照主题建立各种数据模型。

DW 层又细分为 DWD（Data Warehouse Detail）层、DWM（Data WareHouse Middle）层和 DWS（Data WareHouse Servce） 层。

##### 1) 数据明细层：DWD（Data Warehouse Detail）

该层一般保持和 ODS 层一样的数据粒度，并且提供一定的数据质量保证。DWD 层要做的就是将数据清理、整合、规范化、脏数据、垃圾数据、规范不一致的、状态定义不一致的、命名不规范的数据都会被处理。

同时，为了提高数据明细层的易用性，该层会采用一些维度退化手法，将维度退化至事实表中，减少事实表和维表的关联。

另外，在该层也会做一部分的数据聚合，将相同主题的数据汇集到一张表中，提高数据的可用性 。

##### 2) 数据中间层：DWM（Data WareHouse Middle）

该层会在 DWD 层的数据基础上，数据做轻度的聚合操作，生成一系列的中间表，提升公共指标的复用性，减少重复加工。

直观来讲，就是对通用的核心维度进行聚合操作，算出相应的统计指标。

在实际计算中，如果直接从 DWD 或者 ODS 计算出宽表的统计指标，会存在计算量太大并且维度太少的问题，因此一般的做法是，在 DWM 层先计算出多个小的中间表，然后再拼接成一张 DWS 的宽表。由于宽和窄的界限不易界定，也可以去掉 DWM 这一层，只留 DWS 层，将所有的数据再放在 DWS 亦可。

##### 3) 数据服务层：DWS（Data WareHouse Servce）

DWS 层为公共汇总层，会进行轻度汇总，粒度比明细数据稍粗，基于 DWD 层上的基础数据，整合汇总成分析某一个主题域的服务数据，一般是宽表。DWS 层应覆盖 80% 的应用场景。又称数据集市或宽表。

按照业务划分，如主题域流量、订单、用户等，生成字段比较多的宽表，用于提供后续的业务查询，OLAP 分析，数据分发等。

一般来讲，该层的数据表会相对比较少，一张表会涵盖比较多的业务内容，由于其字段较多，因此一般也会称该层的表为宽表。

#### 3. 数据应用层：APP（Application）

在这里，主要是提供给数据产品和数据分析使用的数据，一般会存放在 ES、 PostgreSql、Redis 等系统中供线上系统使用，也可能会存在 Hive 或者 Druid 中供数据分析和数据挖掘使用。比如我们经常说的报表数据，一般就放在这里。

#### 4. 维表层（Dimension）

如果维表过多，也可针对维表设计单独一层，维表层主要包含两部分数据：

**高基数维度数据**：一般是用户资料表、商品资料表类似的资料表。数据量可能是千万级或者上亿级别。

**低基数维度数据**：一般是配置表，比如枚举值对应的中文含义，或者日期维表。 数据量可能是个位数或者几千几万。

### **2. 主题域划分原则**

#### 1) 按照业务或业务过程划分

业务容易理解，就是指的功能模块 / 业务线。

业务过程：指企业的业务活动事件，如下单、支付、退款都是业务过程。不过需要注意的是，一个业务过程是一个不可拆分的行为事件，通俗的讲，业务过程就是企业活动中的事件。

 ![](https://github.com/Hsu-Outer-Brain/WebCliperCDN_001/blob/main/img3/2024-7-18%2015-05-16/5f8de8d5-5436-4d51-8860-90403e2cc854.png?raw=true) 

#### 2) 按照数据域划分

数据域是指面向业务分析，将业务过程或者维度进行抽象的集合。其中，业务过程可以概括为一个个不可拆分的行为事件，在业务过程下，可以定义指标，维度是指度量的环境，如买家下单事件，买家是维度。为保障整个体系的生命力，数据域是需要抽象提炼，并且长期维护和更新的，但不轻易变动。在划分数据域时，既能涵盖当前所有的业务需求，又能在新业务进入时无影响地被包含进已有的数据域中和扩展新的数据域。

### **3. 数据模型设计原则**

#### 1) 高内聚、低耦合

即主题内部高内聚、 不同主题间低耦合。明细层按照业务过程划分主题，汇总层按照 “实体+ 活动” 划分不同分析主题，应用层根据应用需求划分不同应用主题。

#### 2) 核心模型和扩展模型要分离

建立核心模型与扩展模型体系，核心模型包括的字段支持常用的核心业务，扩展模型包括的字段支持个性化或少量应用的需要，不能让扩展模型的字段过度侵入核心模型，以免破坏核心模型的架构简洁性与可维护性。

#### 3) 公共处理逻辑下沉及单一

越是底层公用的处理逻辑越应该在数据调度依赖的底层进行封装与实现，不要让公用的处理逻辑暴露给应用实现，不要让公共逻辑多处同时存在。

#### 4) 成本与性能平衡

适当的数据冗余可换取查询和刷新性能，不宜过度冗余与数据复制。

#### 5) 数据可回滚

处理逻辑不变，在不同时间多次运行数据结果确定不变。

## 二、数仓公共开发规范

### **1. 层次调用规范**

稳定业务按照标准的数据流向进行开发，即 ODS –> DWD –> DWS –> APP。非稳定业务或探索性需求，可以遵循 ODS -> DWD -> APP 或者 ODS -> DWD -> DWM ->APP 两个模型数据流。

在保障了数据链路的合理性之后，也必须保证模型分层引用原则：

-   正常流向：ODS -> DWD -> DWM -> DWS -> APP，当出现 ODS -> DWD -> DWS -> APP 这种关系时，说明主题域未覆盖全。应将 DWD 数据落到 DWM 中，对于使用频度非常低的表允许 DWD -> DWS。
-   尽量避免出现 DWS 宽表中使用 DWD 又使用（该 DWD 所归属主题域）DWM 的表。
-   同一主题域内对于 DWM 生成 DWM 的表，原则上要尽量避免，否则会影响 ETL 的效率。
-   DWM、DWS 和 APP 中禁止直接使用 ODS 的表， ODS 的表只能被 DWD 引用。
-   禁止出现反向依赖，例如 DWM 的表依赖 DWS 的表。

举例：

 ![](https://github.com/Hsu-Outer-Brain/WebCliperCDN_001/blob/main/img3/2024-7-18%2015-05-16/584b2054-99f7-4423-bf7a-086992529467.png?raw=true) 

### **2. 数据类型规范**

需统一规定不同的数据的数据类型，严格按照规定的数据类型执行：

1.  **金额**：double 或使用 decimal(28,6) 控制精度等，明确单位是分还是元。
2.  **字符串**：string。
3.  **id 类**：bigint。
4.  **时间**：string。
5.  **状态**：string

### **3. 数据冗余规范**

宽表的冗余字段要确保：

1.  冗余字段要使用高频，下游 3 个或以上使用。
2.  冗余字段引入不应造成本身数据产生过多的延后。
3.  冗余字段和已有字段的重复率不应过大，原则上不应超过 60%，如需要可以选择 join 或原表拓展。

### **4. NULL 字段处理规范**

-   对于维度字段，需设置为 - 1
-   对于指标字段，需设置为 0

### **5. 指标口径规范**

保证主题域内，指标口径一致，无歧义。

通过数据分层，提供统一的数据出口，统一对外输出的数据口径，避免同一指标不同口径的情况发生。

相关实践学习

AnalyticDB MySQL 海量数据秒级分析体验

快速上手 AnalyticDB MySQL，玩转 SQL 开发等功能！本教程介绍如何在 AnalyticDB MySQL 中，一键加载内置数据集，并基于自动生成的查询脚本，运行复杂查询语句，秒级生成查询结果。

阿里云云原生数据仓库 AnalyticDB MySQL 版 使用教程

云原生数据仓库 AnalyticDB MySQL 版是一种支持高并发低延时查询的新一代云原生数据仓库，高度兼容 MySQL 协议以及 SQL:92、SQL:99、SQL:2003 标准，可以对海量数据进行即时的多维分析透视和业务探索，快速构建企业云上数据仓库。 了解产品 [https://www.aliyun.com/product/ApsaraDB/ads](https://www.aliyun.com/product/ApsaraDB/ads)
