# python量化回测（一）可转债高折价策略 量化回测 收益率与最大回撤 增加轮动条件
本文原文首发在公众号：**可转债量化分析** 里面。本文对原来的回测条件做了不同的参数设置，得到更多的回测结果与效果对比，同时代码也修复了部分的 bug 和显示每天的净值曲线。

主要用 python 对折价策略进行了回测，使用的平台是优矿。

![](https://article-images.zsxq.com/FpzkihQ_LA63E2INubBTF8SCV-KZ)

当时的节选的部分溢价率排名

**策略说明：** 

顾名思义，折价策略，就是选择**折价率最高的 10 只可转债**，在一个时间范围里面轮动。如果到了下一个时间节点（比如一周后），重新获取 10 只折价率最高的可转债，那么就把上一批可转债掉出前 10 名的卖掉，买入最新一批进入前十的折价可转债。周而复此，不断轮动，中途记录每笔买卖，计算最大回撤与收益率。

**注：原文中的条件只有 10 只转债，且轮动周期为 1 周。在本文将调节这个参数，看看实际收益率于最大回撤的变化。**  同时数据也更新到最近的 7 月份。

**回测条件：** 

笔者把回测开始时间设定在 2018 年 1 月 1 日，可转债信用申购新规后，可转债容量开始扩容。

回测终止时间为 2021 年 7 月 6 日，也就是当前时间的最后一个交易日，时间跨度为 3 年 4 个月。

买入标的为可转债债，不包含可交换债和纯债。

回测平台使用优矿，如果动手能力强，也可以在本地使用 python 配置相应的量化回测平台。

回测资金使用 100W。

**代码实现：** 

部分代码可以复用之前公众号里面文章里面的，比如获取所有可转债代码，并且过滤纯债，EB 可交换债。

核心代码如下：

-   初始参数
-

![](https://article-images.zsxq.com/FrkIl_W6jYvnMZUFUVUaHnizmm40)

上面的的参数看个人喜好而定，有人喜欢折价策略摊大饼的，那么可以把持债个数设为 20，30 等等，可以看看转债分散程度对最大回撤和收益的影响。

handle_data: 周期运行，设定为 5 个交易日（一周）运行一次，可以使用更长周期或更短周期，1 天或者 1 个月

![](https://article-images.zsxq.com/FjHhPKRcGHgtV_YnR1OlYsqzGh4Y)

周期运行的函数 handle_data: 这个是优矿固定的函数，会在每个周期执行一遍，里面也就是核心计算函数代码。因为优矿不支持可转债的模拟买卖，所以需要自己写一个模拟买卖的交易数据与仓位。

**handle_data 部分代码**

![](https://article-images.zsxq.com/FuS_xE4C_PMDEXsnVYW9hIU_8PSw)

![](https://article-images.zsxq.com/Fng_cI7kKMgaxExwl8tAD3ZaZLkD)

![](https://article-images.zsxq.com/FuOZq3NA1MayNsX0-F5Jx5RBFG0V)

![](https://article-images.zsxq.com/FqN98WV_bsZMKD96Q3ZmZrzBjYdD)

【知识星球的代码编辑器不友好，格式还没我用 typora 的 markdown 好看，所以就直接用截图了 -\_-||】

代码中有些异常处理要注意的，比如上周买入的折价已经被强赎了，下一周的时候需要按照强赎日的收盘价卖出，不然但交易日当天会找不到被强赎的转债数据。

**回测运行结果**

截取部分中间执行结果，文末有**获取所有交易记录**的方法。

![](https://article-images.zsxq.com/FhmsfveNaKJAfg-f55hOCfDfy8j9)

2018 年开始执行的中间数据

![](https://article-images.zsxq.com/FrYXl_LBH7VYNx-LzHDfyFobTztf)

2018 年开始执行的中间数据，跑到 2018 年 8 月，折价策略勉强保本，**最大回撤有 \*\***11%\*\*。

中间因为篇幅省略若干，基本每周都会发生交易。

直接跳到最后：

![](https://article-images.zsxq.com/FpuXU70LoThk-1N-zbBTFfHgkNu_)

大概耗时 1 分 12 秒回测完毕。

最后一次调仓记录是**2021 年 7 月 05 日**，当初的**100W**现在已经变成了 640W**，当前的收益率为 \*\***540%**！最大回撤值为**18%\*\*。

换算为年化收益，年化收益率达到了**61.9%**。这个收益率与最大回撤比很多优秀的基金经理都要优秀，回撤也控制的很好。

同时年化收益率也大幅跑赢沪深 300。

![](https://article-images.zsxq.com/FmM2Li253sBurT5kLcFgt4NxWrht)

​ 注意：这个是沪深 300 的收益率曲线。

沪深 300 基准年化 7 收益率为**7.7%**。

根据日志输出的收益率绘制收益率曲线。

![](https://article-images.zsxq.com/FvxfarUGY8UWiBKXsmiaQ3Rh5xhG)

折价策略收益率曲线

最大回撤发生在 2019 年 6 月（数字在上图不好看得出来，因为曲线被后期收益率拉伸后，前半段显得很窄的跌幅）。

从数据日志中可以得到的：

![](https://article-images.zsxq.com/Fs06ehORUAklPmJxtXIQutGbNYTP)

因为上一个最大回撤是**17.19%**，后面的最大回撤就保持在**18.59%**。

如果从收益分布来看，其实绝大部分的收益从 2020 年贡献的，因为从数据得到，截至 2019 年 10 月份，折价策略的总收益为 32%，经过 2020 年的抱团行情和疫情收益股，才把总体收益率拉伸到 410%。

所以笔者认为折价策略是一个优秀的策略，但同时有一丝丝的不确定的担忧，因为对于脱离债底的高价折价可转债（转债价格大于 180 以上），其实质和买入正股差不多（排除像英科转债这种高价高分红导致转股价大幅下调的个例），因为从回测数据中，2018 年的熊市中，对于折价可转债而言，虽然有一定回撤，但是因为本身转债价格不高，在面值附近折价，有债底的保护，即使遇到暴跌行情亏损也不会太大。

对于激进投资者，买入高价折价转债等同于买入正股，可以采用转债套利策略，买入的高价折价转债后转股，股票可卖后继续买回其折价转债，因为本质都是看好正股继续涨。

目前还没大面积发生高价折价转债的正股进入漫长熊市，从而让转债也跟随大幅下跌，即使轮到到其他折价的转债，在普跌行情下轮动后转债也跟随下跌，这种情形下的回撤应该会非常大，虽然还没发生，但转债行情多变，每年都有新花样，就像突破 3000 元的英科转债，溢价率 400% 多且其价格也能维持在 400 多的横河转债。

**新增内容：** 

**轮动周期**

如果把轮动天数改为 3 天。其他条件保持不变，看看这对整体收益率和最大回撤的影响是如何。

运行结果：

![](https://article-images.zsxq.com/FrLrbrbBt15YyFMrt9AIvNoJbswk)

其运行至 2021 年 7 月 2 日的最大收益是 665%，最大回撤在 18.18%

3 天轮动与 5 天轮动的收益率对比图

![](https://article-images.zsxq.com/FtUhmOmoWerG2INHUpMu_yCC_ygJ)

从回测结果看出，轮动频率越高，其收益率越高，高了大约 110%，但其最大回撤时候没有增加。

**持有个数变动**

这次我们的轮动周期不变，保持为一周，也就是 5 天轮动一次。而把持有可转债的个数由 10 个改为 5 个。

![](https://article-images.zsxq.com/FnnTWtglwKjZADsyNPgDc5U7JXdN)

![](https://article-images.zsxq.com/FpwIP0cOSut4NoJLSy3dTtxY3MYz)

持有 5 只转债与 10 只转债的收益率对比图

对比后，只有转债个数为 5 的折价策略回测收益率是如此炸裂。3.5 年的总收益率为 894% ！ 折合年化收益率 86.9% ！

可以在保存的交易记录里面查看，每次调仓的记录：

![](https://article-images.zsxq.com/FvcDYigzCMjL9jPr85AYwOjbdV1E)

调仓记录一角

从最后几次调仓来看，基本每一次都是拿着当时转债中闪耀的品种，比如收购酒业的众兴转债，新能源相关的道氏转债，以及最近正股连拉 20CM 的华自转债。

其最大回撤是 24.99%，比 10 个大饼转债的波动打了 7 个点左右，但是收益率却要多 350 个点。如此惊人的收益率，一度让我觉得我代码是不是哪里有 bug 写错了。于是我有用了其他的回测代码尝试，还有调整起始时间点，但最终结果相差都不大，在 10% 的误差范围内。

只是折价策略过于考验个人心脏承受能力，对于资金量比较大，大饼数小于 5 个估计每天的波动都考验人。不过由于可转债有一个天然的优势，就是容易量化，且判断标准简单。所以对于这种需要人为纪律性很强的操作，交个程序去自动化执行是再好不过的了，比如一个转债从折价暴跌到溢价，在一个轮动周期内就轮动出了目标范围，机器可以毫无感情地割掉，而作为有情感的人，得锻炼多少次如此的场景才能练就果断的调仓呢。 
 [https://articles.zsxq.com/id_7o1en3hbld6o.html](https://articles.zsxq.com/id_7o1en3hbld6o.html)
